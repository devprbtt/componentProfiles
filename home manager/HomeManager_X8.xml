<?xml version="1.0" encoding="UTF-8"?>
<component xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="racepoint_component_profile.xsd" manufacturer="HomeManager" model="X8" device_class="Lighting_controller" rpm_xml_version="$Revision: 1.3 $" minimum_component_engine_version="0.0">
<notes>
	Biblioteca de integração Savant com os módulos X-8 da Home Manager.
	
	Na configuração do módulo, é necessário informar o último dígito do IP, para se obter um IP fixo de acesso e configurar no projeto Savant.
	
	Tipos de dispositivos disponíveis:
	
	- SWITCH: Dispositivo de iluminação do tipo liga/desliga. Utilize esse tipo mesmo quando for uma saída dimerizável configurada como liga/desliga.
		* Address[1] -> Identificador da saída (1|2|3|4|5|6|7|8)
		* Obs: utiliza os comandos SwitchOn e SwitchOff
	
	- DIMMER: Dispositivo de iluminação dimerizável. O tempo de rampa pode ser alterado no sistema Home Manager.
		* Address[1] -> Identificador da saída (1|2|3|4|5|6|7|8)
		* Obs: utiliza o comando DimmerSet
	
	- SHADE: Dispositivo para cortina/persinas controladas por botões UP/DOWN/STOP. É necessário informar no sistema Home Manager o tempo total do curso para o funcionamento correto de forma descentralizada pelas teclas.
		* Address[1] -> Identificador da saída para posição de subida (1|2|3|4|5|6|7|8)
		* Address[2] -> Identificador da saída para posição de descida (1|2|3|4|5|6|7|8)
		* Obs: utiliza os comandos ShadeUp, ShadeDown e ShadeStop

	- BUTTON: Dispositivo de acionamento/pulso, acionados por um botão na interface Savant.
		* Address[1] -> Identificador da saída (1|2|3|4|5|6|7|8)

	- KEYPAD BUTTON: Dispositivo do tipo botão, com as variáveis isButtonClick e isButtonHold para tecla do tipo PULSADOR e isButtonPressed para INTERRUPTOR.
		* Address[1] -> Número da entrada do módulo (1|2|3|4|5|6|7|8|9|A|B|C)
	
	Obs: Pelo sistema da Home Manager, é possível exportar um arquivo .plist de cada módulo e importar todos os dispositivos no projeto Savant.

</notes>

    <control_interfaces preferred="ip">
        <ip port="29090" response_time_length_ms="500" name_on_component="Ethernet">
            <send_postfix type="hex">0D</send_postfix>
            <receive_end_condition test_condition="data" type="hex">0D</receive_end_condition>
        </ip>
    </control_interfaces>

    <media_interfaces>
        <data name_on_component="Ethernet">
            <combined_media>
                <data_media type="ethernet"/>
                <control port="29090"/>
            </combined_media>
        </data>
        <internal name_on_component="Lighting Controller">
            <environmental_media/>
            <resource resource_type="ENV_LIGHTINGCONTROLLER_SOURCE"/>
            <resource resource_type="ENV_SHADECONTROLLER_SOURCE"/>
        </internal>
    </media_interfaces>

    <logical_component logical_component_name="Lighting_controller">
        <implementation>
            <internal name_on_component="Lighting Controller"/>
        </implementation>

       <!--************************************************************************************************************************-->
       <!--********************************************           STATUS           ***********************************************-->
       <!--************************************************************************************************************************-->
       
       <status_messages>
           <status_message name="CurrentDeviceStatus">
               <constant type="character">#PCT-</constant>
               <data type="character" constant_length="1">
                   <update state="DeviceID" type="string"/>
               </data>
               <data type="character" constant_length="3">
                   <update state="DeviceStatus" type="string"></update>                
               </data>
               <append_data_to_state_names state="DeviceID" note="1|2|3|4|5|6|7|8"/>
           </status_message>
      		
           <status_message name="CurrentButtonState">
               <constant type="character">#BTN-</constant>
               <data type="character" constant_length="1">
                   <update state="InputNumber" type="string"/>
               </data>
               <data type="character" constant_length="1">
                   <data_map match_required="yes">
                       <map key="0">
                           <update state="isButtonClick" type="boolean">true</update>
                       </map>
                       <map key="1">
                           <update state="isButtonHold" type="boolean">true</update>
                       </map>
                       <map key="9">
                           <update state="isButtonClick" type="boolean">false</update>
                           <update state="isButtonHold" type="boolean">false</update>
                       </map>
                       <map key="2">
                            <update state="isButtonPressed" type="boolean">true</update>
                       </map>
                       <map key="3">
                            <update state="isButtonPressed" type="boolean">false</update>
                       </map>
                   </data_map>
               </data>
               <data type="character" terminator_type="end_of_data">
               </data>
               <append_data_to_state_names state="InputNumber" note="INPUT_NUMBER (1|2|3|4|5|6|7|8|9|A|B|C)"/>
           </status_message>

        </status_messages>

        <!--************************************************************************************************************************-->
	<!--***************************************           LIGHTING / BUTTON           ******************************************-->
	<!--************************************************************************************************************************-->
        
        <resource_component_actions resource_type="ENV_LIGHTINGCONTROLLER_SOURCE">
            <action name="SwitchOn">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">1</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>
            <action name="SwitchOff">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">0</parameter>
                        </parameter_list>
                       <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>
            <action name="SwitchToggle">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">!</parameter>
                        </parameter_list>
                       <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>
            
            <action name="DimmerSet">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <action_argument name="DimmerLevel" note="Target Intensity (0 - 100) %"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">%</parameter>
                            <parameter parameter_data_type="character" action_argument="DimmerLevel" parameter_total_width="3" parameter_data_width="3"></parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>

            <action name="ExecutePulse">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#T</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="5" parameter_data_width="5">00006</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>

            <action name="ButtonPress">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#T</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="5" parameter_data_width="5">00006</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>

            <action name="ButtonPressAndRelease">
                <action_argument name="Address1" note="INPUT_NUMBER (1|2|3|4|5|6|7|8|9|A|B|C)"/>
                <command_interface interface="ip">
                    <command response_required="no" partial_response="no">
                    	<command_string type="character">#BTN-</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">0</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>
            <action name="ButtonHold">
                <action_argument name="Address1" note="INPUT_NUMBER (1|2|3|4|5|6|7|8|9|A|B|C)"/>
                <command_interface interface="ip">
                    <command response_required="no" partial_response="no">
                        <command_string type="character">#BTN-</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">1</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>

            <!--************************************************************************************************************************-->
            
            <entity name="Switch" address_components="1">
                <toggle_button_representation>
                    <release_action name="SwitchOn"></release_action>
                    <toggle_release_action name="SwitchOff"></toggle_release_action>
                    <osd_press_action name="SwitchOn"></osd_press_action>
                    <osd_hold_action name="SwitchOff"></osd_hold_action>
                    <toggleOnUsingState name="DeviceStatus">
                        <unique_identifier name="DeviceID" address_component="1"/>
                    </toggleOnUsingState>
                </toggle_button_representation>
                <!--<query_status_with_action name="QueryDeviceState" period_ms="0">
                    <with_arg name="Address1" address_component="1"/>
                </query_status_with_action>-->
            </entity>

            <entity name="Dimmer" address_components="1">
                <slider_representation>
                    <press_action name="DimmerSet"/>
                    <valueSource name="DeviceStatus">
                        <unique_identifier name="DeviceID" address_component="1"/>
                    </valueSource>
                </slider_representation>
                <!--<query_status_with_action name="QueryDeviceState" period_ms="0">
                    <with_arg name="Address1" address_component="1"/>
                </query_status_with_action>-->
            </entity>
            
            <entity name="Button" address_components="1">
                <push_button_representation>
                    <press_action name="ButtonPress"/>
                </push_button_representation>
            </entity>

            <entity name="Keypad Button" address_components="2">
            	<toggle_button_representation sendReleaseActionAfterHoldAction="false">
                    <hold_action name="ButtonHold"></hold_action>
                    <release_action name="ButtonPressAndRelease"></release_action>
                    <toggle_hold_action name="ButtonHold"></toggle_hold_action>
                    <toggle_release_action name="ButtonPressAndRelease"></toggle_release_action>
                </toggle_button_representation>
            </entity>
 
        </resource_component_actions>

        <!--************************************************************************************************************************-->
	<!--**********************************************           SHADES           **********************************************-->
	<!--************************************************************************************************************************-->

        <resource_component_actions resource_type="ENV_SHADECONTROLLER_SOURCE">
            <action name="ShadeUp">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <action_argument name="Address2" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#+</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" action_argument="Address2"/>
                            <parameter parameter_data_type="character" parameter_total_width="5" parameter_data_width="5">!1800</parameter>
                        </parameter_list>
                    </command>
                </command_interface> 
            </action>
            <action name="ShadeDown">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <action_argument name="Address2" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#-</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" action_argument="Address2"/>
                            <parameter parameter_data_type="character" parameter_total_width="5" parameter_data_width="5">!1800</parameter>
                        </parameter_list>
                    </command>
                </command_interface> 
            </action>
            <action name="ShadeStop">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <action_argument name="Address2" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#+</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" action_argument="Address2"/>
                            <parameter parameter_data_type="character" parameter_total_width="5" parameter_data_width="5">00000</parameter>
                        </parameter_list>
                    </command>
                </command_interface> 
            </action>

            <!--************************************************************************************************************************-->
           
            <entity name="Shade" address_components="2">
                <group_representation>
                    <push_button_representation>
                        <release_action name="ShadeUp"></release_action>
                        <osd_press_action name="ShadeUp"></osd_press_action>
                    </push_button_representation>
                    <push_button_representation>
                        <release_action name="ShadeDown"></release_action>
                        <osd_press_action name="ShadeDown"></osd_press_action>
                    </push_button_representation>
                    <push_button_representation>
                        <release_action name="ShadeStop"></release_action>
                        <osd_press_action name="ShadeStop"></osd_press_action>
                    </push_button_representation>
                </group_representation>
            </entity>
        </resource_component_actions>
      
        <!--************************************************************************************************************************-->
        
        <custom_component_actions>
            <!--<action name="QueryDeviceState">
                <action_argument name="Address1" note="MODULE_OUTPUT (1|2|3|4|5|6|7|8)"/>
                <command_interface interface="ip">
                    <command response_required="yes">
                        <command_string type="character">#</command_string>
                        <parameter_list>
                            <parameter parameter_data_type="character" action_argument="Address1"/>
                            <parameter parameter_data_type="character" parameter_total_width="1" parameter_data_width="1">?</parameter>
                        </parameter_list>
                        <delay ms_delay="300"/>
                    </command>
                </command_interface>
            </action>  -->
            <action name="KeepAlive">
                <command_interface interface="ip">
                    <command response_required="no">
                        <command_string type="character">#CRD-SVT@9</command_string>
                        <delay ms_delay="500"/>
                    </command>
                </command_interface>
                <execute_on_schedule period_ms="45000"/>
            </action>
        </custom_component_actions>
    </logical_component>
</component>
